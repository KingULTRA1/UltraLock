<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>UltraLock — Test Page</title>
</head>
<body>
  <h1>UltraLock — Quick Manual Tests</h1>
  <p>Open the console to see debug logs. Try selecting the inputs below and use Copy / Paste to test behavior.</p>

  <div>
    <label>ETH example:</label>
    <input id="eth" value="0xde709f2102306220921060314715629080e2fb77" style="width:480px" />
  </div>

  <div>
    <label>BTC (real):</label>
    <input id="btc-real" value="bc1qw9cqf600jzcvkd53lpf6j9w93x806z5x5c0t8q" style="width:640px" />
  </div>

  <div>
    <label>Lightning invoice (real):</label>
    <input id="ln" value="lnbc1p55tcmqdqdgdshx6pqg9c8qpp5kduld8g5a36krmgy3gpejkr4wwcvpql33klwvwq3wqfefzuwcjpssp5g38e2nkfcclnfuazs9cu4kcp80gtxd308ldz4hvvqpx86efrxwvs9qrsgqcqpcxqy8ayqrzjqtsjy9p55gdceevp36fvdmrkxqvzfhy8ak2tgc5zgtjtra9xlaz97r026vqqv8qqquqqqqqqqqqqqqqq9grzjqfzhphca8jlc5zznw52mnqxsnymltjgg3lxe4ul82g42vw0jpkgkwzzl0sqqxgsqqqqqqqqqqqqqqqqq9gwhhm904pkn7zd9ju7lfr2y26fxdcvusck6x3z0tvdf905pe6j3sk25mjanq00lks6r7ve5amsk03kz9fk73yzvpdgjlasysz9r52wqcpdm7a3r" style="width:640px" />
  </div>

  <div>
    <label>Generic text:</label>
    <input id="any" value="hello world" style="width:480px" />
  </div>

  <p>Try selecting the ETH or BTC line and pressing Ctrl+C, then focus another input and press Ctrl+V. For alerts, the script will block on mismatch and show a blocking UI.</p>

  <div style="margin-top:16px;padding:12px;border:1px solid #ccc;max-width:640px;background:#f9f9f9">
    <h3>Automation helpers (for debugging)</h3>
    <p><strong>Test:</strong> Copy the BTC address below. Modify it. Paste it. UltraLock will block it.</p>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button id="btn-copy-btc">Simulate Copy BTC (real)</button>
      <button id="btn-paste-good">Simulate Paste (good)</button>
      <button id="btn-paste-bad">Simulate Paste (bad/mismatch)</button>
      <button id="btn-show-meta">Show Memory Meta</button>
    </div>
    <pre id="debug-output" style="margin-top:8px;white-space:pre-wrap;background:#111;color:#0f0;padding:8px;border-radius:4px;max-height:200px;overflow:auto"></pre>
  </div>

  <script>
    const out = (s) => { const el = document.getElementById('debug-output'); el.textContent += s + '\n'; el.scrollTop = el.scrollHeight; };

    // Simulate a secure copy using UltraLock API
    document.getElementById('btn-copy-btc').addEventListener('click', async () => {
      const el = document.getElementById('btc-real');
      const text = el.value || el.textContent || '';
      const detected = window.UltraLockInternal && window.UltraLockInternal.detectAddress ? window.UltraLockInternal.detectAddress(text) : null;
      if (!detected) { out('No address detected for copy'); return; }
      await (window.UltraLock && window.UltraLock.bindClipboard && window.UltraLock.bindClipboard(detected.address, detected.chain));
      out('Simulated secure copy of: ' + detected.address);
    });

    document.getElementById('btn-paste-good').addEventListener('click', async () => {
      const meta = window.UltraLock && window.UltraLock.readMeta && (await window.UltraLock.readMeta());
      const text = (meta && meta.canonical) || document.getElementById('btc-real').value;
      const ev = new Event('paste', { bubbles: true, cancelable: true });
      ev.clipboardData = { getData: (t) => text }; document.dispatchEvent(ev);
      out('Simulated paste-good with text: ' + text + '; defaultPrevented=' + (ev.defaultPrevented ? 'yes' : 'no'));
    });

    document.getElementById('btn-paste-bad').addEventListener('click', () => {
      const text = document.getElementById('btc-real').value.replace(/.$/, (c) => c === '0' ? '1' : '0');
      const ev = new Event('paste', { bubbles: true, cancelable: true });
      ev.clipboardData = { getData: (t) => text };
      document.dispatchEvent(ev);
      out('Simulated paste-bad with text: ' + text + '; defaultPrevented=' + (ev.defaultPrevented ? 'yes' : 'no'));
    });

    document.getElementById('btn-show-meta').addEventListener('click', async () => {
      const meta = (window.UltraLock && window.UltraLock.readMeta && (await window.UltraLock.readMeta())) || null;
      out('Clipboard meta: ' + JSON.stringify(meta));
    });
  </script>

  <script src="UltraLock.js"></script>
</body>
</html>
